<!DOCTYPE html>
<html lang="en">

<head>
    <script type="module">
        console.log("add event listner");
        addEventListener("TrunkApplicationStarted", (event) => {
        console.log("application started - bindings:", window.wasmBindings, "WASM:", event.detail.wasm);
        // wasm_ffi is a function exported from WASM to JavaScript
        window.wasmBindings.wasm_ffi();
        // You can also run this via the WASM instance in the details
        // event.detail.wasm.wasm_ffi();
      });
      </script>
    <script>
        const S3_VERSION = '2006-03-01';
        window.uploadToS3 = (access_key, secret_key, region, bucketName, key, src) => {
            const credentials = new AWS.Credentials({
                accessKeyId: access_key,
                secretAccessKey: secret_key,
                sessionToken: null
            });
            AWS.config.update({
                credentials: credentials
            });

            const s3 = new AWS.S3({ apiVersion: S3_VERSION, region: region });

            return new Promise((resolve, reject) => {
                s3.upload(
                    {
                        Bucket: bucketName,
                        Key: `${key}`,
                        Body: src,
                    },
                    { partSize: 20 * 1024 * 1024, queueSize: 1 },
                    (err, data) => {
                        if (err) resolve("error");
                        else resolve("success");
                    }
                );
            });
        }
        window.deleteObject = (access_key, secret_key, region, bucketName, prefix, name) => {
            const credentials = new AWS.Credentials({
                accessKeyId: access_key,
                secretAccessKey: secret_key,
                sessionToken: null
            });
            AWS.config.update({
                credentials: credentials
            });

            const s3 = new AWS.S3({ apiVersion: S3_VERSION, region: region });

            return new Promise((resolve, reject) => {
                const params = {
                    Bucket: bucketName,
                    Key: `${prefix}${name}`,
                };
                s3.deleteObject(params, (err, data) => {
                    if (err) {
                        resolve("error");
                    } else {
                        resolve("success");
                    }
                });
            });
        }
    </script>


    <meta charset="UTF-8" />

    <meta name="description" content="Weblum App" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#e66956" />

    <title>Weblum App</title>
    <link data-trunk rel="rust" data-wasm-opt="z" />
    <link data-trunk rel="scss" href="scss/style.scss" />
    <link data-trunk rel="copy-dir" href="generated/js/" />

    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("serviceWorker.js", {scope: "/"}).then(
                (registration) => {
                    console.log("Service worker registration succeeded:", registration);
                },
                (error) => {
                    console.error(`Service worker registration failed: ${error}`);
                },
            );
        } else {
            console.error("Service workers are not supported.");
        }
        const channel = new BroadcastChannel("test")
        channel.onmessage = (e) => {
            console.log("message received")
            console.log(e)
        }

    </script>
</head>
<body>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/aws-sdk/2.1472.0/aws-sdk.min.js"></script>



</html>